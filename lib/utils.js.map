{"version":3,"sources":["../src/utils.js"],"names":["find","deepCopy","forEachValue","isObject","isPromise","assert","normalizeMap","Watch","watchState","mi","list","f","filter","curry","fn","arity","length","nextCurried","args","prevArgs","nextArg","obj","cache","hit","c","original","copy","Array","isArray","push","Object","keys","forEach","key","val","then","condition","msg","Error","map","callback","that","observe","_obj","path","type","prototype","toString","call","observeObj","cloneArray","t","prop","tpath","slice","defineProperty","get","set","newVal","a_array","ORP","arrayProto","newProto","create","value","apply","arguments","enumerable","configurable","writable","__proto__","object","onChange","handler","target","property","receiver","Proxy","err","Reflect","descriptor","deleteProperty","isOperator","calCommonExp","getPrioraty","prioraty","outputRpn","calRpnExp","operatorString","indexOf","v1","v2","exp","inputStack","outputStack","outputQueue","firstIsOperator","replace","substring","i","max","cur","shift","po","pop","Number","rpnArr","stack","num1","num2","num"],"mappings":"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","file":"utils.js","sourcesContent":["/**\r\n *\r\n * @param {Array} list\r\n * @param {Function} f\r\n * @return {*}\r\n */\r\nexport function find(list, f) {\r\n  return list.filter(f)[0]\r\n}\r\nvar curry =\r\n  (fn, arity = fn.length, nextCurried) =>\r\n  (nextCurried = prevArgs =>\r\n    nextArg => {\r\n      var args = [...prevArgs, nextArg];\r\n\r\n      if (args.length >= arity) {\r\n        return fn(...args);\r\n      } else {\r\n        return nextCurried(args);\r\n      }\r\n    }\r\n  )([]);\r\nexport {\r\n  curry\r\n}\r\n/**\r\n *\r\n * @param {*} obj\r\n * @param {Array<Object>} cache\r\n * @return {*}\r\n */\r\nexport function deepCopy(obj, cache = []) {\r\n\r\n  if (obj === null || typeof obj !== 'object') {\r\n    return obj\r\n  }\r\n\r\n\r\n  const hit = find(cache, c => c.original === obj)\r\n  if (hit) {\r\n    return hit.copy\r\n  }\r\n\r\n  const copy = Array.isArray(obj) ? [] : {}\r\n\r\n  cache.push({\r\n    original: obj,\r\n    copy\r\n  })\r\n\r\n  Object.keys(obj).forEach(key => {\r\n    copy[key] = deepCopy(obj[key], cache)\r\n  })\r\n\r\n  return copy\r\n}\r\n\r\n/**\r\n * forEach for object\r\n */\r\nexport function forEachValue(obj, fn) {\r\n  Object.keys(obj).forEach(key => fn(obj[key], key))\r\n}\r\n\r\nexport function isObject(obj) {\r\n  return obj !== null && typeof obj === 'object'\r\n}\r\n\r\nexport function isPromise(val) {\r\n  return val && typeof val.then === 'function'\r\n}\r\n\r\nexport function assert(condition, msg) {\r\n  if (!condition) throw new Error(`[vuex] ${msg}`)\r\n}\r\nexport function normalizeMap(map) {\r\n  return Array.isArray(map) ?\r\n    map.map(function (key) {\r\n      return ({\r\n        key: key,\r\n        val: key\r\n      });\r\n    }) :\r\n    Object.keys(map).map(function (key) {\r\n      return ({\r\n        key: key,\r\n        val: map[key]\r\n      });\r\n    })\r\n}\r\nexport function Watch(obj, callback) {\r\n  var that = this\r\n  // debugger\r\n  // var ua = navigator.userAgent.toLowerCase();\r\n  // if (ua.match(/MicroMessenger/i) == \"micromessenger\") {\r\n  //   //ios的ua中无miniProgram，但都有MicroMessenger（表示是微信浏览器）\r\n  //   wx.miniProgram.getEnv((res) => {\r\n  //     if (res.miniprogram) {\r\n  //       that = wx\r\n  //     } else {\r\n  //       that = window\r\n  //     }\r\n  //   })\r\n  // } else {\r\n  //   that = window\r\n  // }\r\n  that.callback = callback;\r\n  //监听_obj对象 判断是否为对象,如果是数组,则对数组对应的原型进行封装\r\n  //path代表相应属性在原始对象的位置,以数组表示. 如[ 'a', 'dd', 'ddd' ] 表示对象obj.a.dd.ddd的属性改变\r\n  that.observe = function (_obj, path) {\r\n    var type = Object.prototype.toString.call(_obj);\r\n    if (type == '[object Object]' || type == '[object Array]') {\r\n      that.observeObj(_obj, path);\r\n      if (type == '[object Array]') {\r\n        that.cloneArray(_obj, path);\r\n      }\r\n    }\r\n  };\r\n\r\n  //遍历对象obj,设置set,get属性,set属性能触发callback函数,并将val的值改为newVal\r\n  //遍历结束后再次调用observe函数 判断val是否为对象,如果是则在对val进行遍历设置set,get\r\n  that.observeObj = function (obj, path) {\r\n    var t = that;\r\n    Object.keys(obj).forEach(function (prop) {\r\n      var val = obj[prop];\r\n      var tpath = path.slice(0);\r\n      tpath.push(prop);\r\n      Object.defineProperty(obj, prop, {\r\n        get: function () {\r\n          return val;\r\n        },\r\n        set: function (newVal) {\r\n          t.callback(tpath, newVal, val);\r\n          val = newVal;\r\n        }\r\n      });\r\n      t.observe(val, tpath);\r\n    });\r\n  };\r\n\r\n  //通过对特定数组的原型中间放一个newProto原型,该原型继承于Array的原型,但是对push,pop等数组操作属性进行封装\r\n  that.cloneArray = function (a_array, path) {\r\n    var ORP = ['push', 'pop', 'shift', 'unshift', 'splice', 'sort', 'reverse'];\r\n    var arrayProto = Array.prototype;\r\n    var newProto = Object.create(arrayProto);\r\n    var t = that;\r\n    ORP.forEach(function (prop) {\r\n      Object.defineProperty(newProto, prop, {\r\n        value: function (newVal) {\r\n          path.push(prop);\r\n          t.callback(path, newVal);\r\n          arrayProto[prop].apply(a_array, arguments);\r\n        },\r\n        enumerable: false,\r\n        configurable: true,\r\n        writable: true\r\n      });\r\n    });\r\n    a_array.__proto__ = newProto;\r\n  };\r\n\r\n  //开始监听obj对象,初始path为[]\r\n  that.observe(obj, []);\r\n}\r\n// 考虑proxy的兼容性，已废弃\r\nexport function watchState(object, onChange) {\r\n  const handler = {\r\n    get(target, property, receiver) {\r\n      try {\r\n        return new Proxy(target[property], handler);\r\n      } catch (err) {\r\n        return Reflect.get(target, property, receiver);\r\n      }\r\n    },\r\n    defineProperty(target, property, descriptor) {\r\n      onChange(target, property, descriptor);\r\n      return Reflect.defineProperty(target, property, descriptor);\r\n    },\r\n    deleteProperty(target, property) {\r\n      onChange(target, property);\r\n      return Reflect.deleteProperty(target, property);\r\n    }\r\n  };\r\n\r\n  return new Proxy(object, handler);\r\n}\r\n\r\nexport function mi() {\r\n  return {\r\n    isOperator: isOperator,\r\n    calCommonExp: calCommonExp,\r\n    getPrioraty: getPrioraty,\r\n    prioraty: prioraty,\r\n    outputRpn: outputRpn,\r\n    calRpnExp: calRpnExp\r\n  }\r\n\r\n  function isOperator(value) {\r\n    var operatorString = '+-*/()×÷';\r\n    return operatorString.indexOf(value) > -1;\r\n  }\r\n\r\n  function getPrioraty(value) {\r\n    if (value == '-' || value == '+') {\r\n      return 1;\r\n    } else if (value == '*' || value == '/' || value == '×' || value == '÷') {\r\n      return 2;\r\n    } else {\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  function prioraty(v1, v2) {\r\n    return getPrioraty(v1) <= getPrioraty(v2);\r\n  }\r\n\r\n  function outputRpn(exp) {\r\n    var inputStack = [];\r\n    var outputStack = [];\r\n    var outputQueue = [];\r\n    var firstIsOperator = false;\r\n    exp.replace(/\\s/g, '');\r\n    if (isOperator(exp[0])) {\r\n      exp = exp.substring(1);\r\n      firstIsOperator = true;\r\n    }\r\n    for (var i = 0, max = exp.length; i < max; i++) {\r\n      if (!isOperator(exp[i]) && !isOperator(exp[i - 1]) && (i != 0)) {\r\n        inputStack[inputStack.length - 1] = inputStack[inputStack.length - 1] + exp[i] + '';\r\n      } else {\r\n        inputStack.push(exp[i]);\r\n      }\r\n    }\r\n    if (firstIsOperator) {\r\n      inputStack[0] = -inputStack[0]\r\n    }\r\n    while (inputStack.length > 0) {\r\n      var cur = inputStack.shift();\r\n      if (isOperator(cur)) {\r\n        if (cur == '(') {\r\n          outputStack.push(cur);\r\n        } else if (cur == ')') {\r\n          var po = outputStack.pop();\r\n          while (po != '(' && outputStack.length > 0) {\r\n            outputQueue.push(po);\r\n            po = outputStack.pop();\r\n          }\r\n        } else {\r\n          while (prioraty(cur, outputStack[outputStack.length - 1]) && outputStack.length > 0) {\r\n            outputQueue.push(outputStack.pop());\r\n          }\r\n          outputStack.push(cur)\r\n        }\r\n      } else {\r\n        outputQueue.push(Number(cur));\r\n      }\r\n    }\r\n    if (outputStack.length > 0) {\r\n      while (outputStack.length > 0) {\r\n        outputQueue.push(outputStack.pop());\r\n      }\r\n    }\r\n    return outputQueue;\r\n  }\r\n\r\n  function calRpnExp(rpnArr) {\r\n    var stack = [];\r\n    for (var i = 0, max = rpnArr.length; i < max; i++) {\r\n      if (!isOperator(rpnArr[i])) {\r\n        stack.push(rpnArr[i]);\r\n      } else {\r\n        var num1 = stack.pop();\r\n        var num2 = stack.pop();\r\n        if (rpnArr[i] == '-') {\r\n          var num = num2 - num1;\r\n        } else if (rpnArr[i] == '+') {\r\n          var num = num2 + num1;\r\n        } else if (rpnArr[i] == '*' || rpnArr[i] == '×') {\r\n          var num = num2 * num1;\r\n        } else if (rpnArr[i] == '/' || rpnArr[i] == '÷') {\r\n          var num = num2 / num1;\r\n        }\r\n        stack.push(num);\r\n      }\r\n    }\r\n    return stack[0];\r\n  }\r\n\r\n  function calCommonExp(exp) {\r\n    var rpnArr = outputRpn(exp);\r\n    return calRpnExp(rpnArr)\r\n  }\r\n}"]}